# Migration `20210331164134-update-stripe-fields`

This migration has been generated by Robin MacPherson at 3/31/2021, 5:41:34 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "MembershipSubscriptionTransaction" DROP COLUMN "stripeChargeId",
DROP COLUMN "stripeChargeData",
ADD COLUMN     "stripeInvoiceId" TEXT NOT NULL,
ADD COLUMN     "stripeInvoiceData" JSONB NOT NULL

ALTER TABLE "User" ALTER COLUMN "userRole" SET DATA TYPE "UserRole"

DROP TYPE "UserRole_new"

DROP TYPE "UserRole_old"

CREATE UNIQUE INDEX "MembershipSubscription.stripeSubscriptionId_unique" ON "MembershipSubscription"("stripeSubscriptionId")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210312022844-remove-free-n-pro-user-roles..20210331164134-update-stripe-fields
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator prisma_client {
   provider      = "prisma-client-js"
@@ -18,9 +18,9 @@
   bio                               String?
   city                              String?
   country                           String?
   posts                             Post[]
-  subscription                      MembershipSubscription?
+  membershipSubscription            MembershipSubscription?
   socialMedia                       SocialMedia?
   languagesNative                   LanguageNative[]
   languagesLearning                 LanguageLearning[]
   languages                         LanguageRelation[]
@@ -300,9 +300,9 @@
   period               MembershipSubscriptionPeriod
   user                 User                         @relation(fields: [userId], references: [id])
   userId               Int
   stripeSubscription   Json
-  stripeSubscriptionId String
+  stripeSubscriptionId String                       @unique
   expiresAt            DateTime?
   createdAt            DateTime                     @default(now())
   updatedAt            DateTime                     @updatedAt
@@ -315,10 +315,10 @@
   chargeCurrency               String
   user                         User                         @relation(fields: [userId], references: [id])
   userId                       Int
   membershipSubscriptionPeriod MembershipSubscriptionPeriod
-  stripeChargeId               String
-  stripeChargeData             Json
+  stripeInvoiceId              String
+  stripeInvoiceData            Json
   createdAt                    DateTime                     @default(now())
   updatedAt                    DateTime                     @updatedAt
 }
```


