# Migration `20210312022844-remove-free-n-pro-user-roles`

This migration has been generated by Robin MacPherson at 3/11/2021, 6:28:44 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Custom SQL PART ONE

The following SQL must be run before this migration is applied:

```sql
UPDATE "User"
SET "userRole" = 'USER'
WHERE "userRole" = 'FREE_USER';

-- We needed to manually drop the existing default in order to set it with Prisma's migration
ALTER TABLE "public"."User" ALTER COLUMN "userRole" DROP DEFAULT;
```

## Custom SQL PART TWO

```sql
ALTER TABLE "public"."User" ALTER COLUMN "userRole" SET DEFAULT 'USER';
```

## Database Steps

```sql
BEGIN;
CREATE TYPE "UserRole_new" AS ENUM ('ADMIN', 'MODERATOR', 'USER');
ALTER TABLE "public"."User" ALTER COLUMN "userRole" TYPE "UserRole_new" USING ("userRole"::text::"UserRole_new");
ALTER TYPE "UserRole" RENAME TO "UserRole_old";
ALTER TYPE "UserRole_new" RENAME TO "UserRole";
DROP TYPE "UserRole_old";
COMMIT
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210312022812-membership-subscription-model..20210312022844-remove-free-n-pro-user-roles
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator prisma_client {
   provider      = "prisma-client-js"
@@ -366,10 +366,8 @@
 enum UserRole {
   ADMIN
   MODERATOR
-  FREE_USER
-  PRO_USER
   USER
 }
 enum PostStatus {
```


